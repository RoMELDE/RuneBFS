(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{41:function(t,e,a){"use strict";a.r(e),a.d(e,"initUiLanguage",function(){return N}),a.d(e,"getActiveMenu",function(){return A}),a.d(e,"setActiveMenu",function(){return M}),a.d(e,"init",function(){return W}),a.d(e,"initByClass",function(){return R});var n=a(1),r=a.n(n),o=a(0),i=a.n(o),c=a(3),s=a(6),u=(a(5),a(39)),d=a.n(u),l=a(40),f=a.n(l),h=a(15),p=a.n(h),v="",g=[],m=[],C=0,b=0,k=0,y=0,x=0,S=.2,w=99999,I="nogold",T=!1,D={1:11,2:21,3:31,4:41,5:51,6:61},N=function(){r()("[data-lang]").each(function(){var t=r()(this),e=t.data("lang"),a=c.a.getText(e);t.text(a)})},A=function(){return v},M=function(t){v=t,r()("nav.navbar [data-type-branch-id].active").removeClass("active");var e=r()("nav.navbar [data-type-branch-id="+t+"]");e.addClass("active"),e.parents("li").addClass("active"),r()("#class").text(e.text())},R=function(t,e,a){D[t]&&(t=D[t]),W(t,e,a)},W=function(t,e,a){a&&a!=s.Data.getCurrentServer().id&&(s.Data.setCurrentServer(a),location.reload()),E(),Y(),B(t,e)},E=function(){g=[],m=[]},Y=function(){if(!T){var t=s.Data.getCurrentServer();r()("#server").text(t.name),r()("#version").text(t.version),t.isTest?r()(".alert").show():r()(".alert").remove(),i.a.each(s.Data.getAllServers(),function(e,a){r()("#serverDivider").before('<a class="dropdown-item '+(e.id==t.id?" active ":"")+(e.version?"":" disabled ")+'" href="#server/'+e.id+'">'+e.name+'<div class="m-0" style="font-size:0.75rem;line-height:0.75rem;"><span class="mr-5">'+e.id+'</span><div class="m-0" style="font-size:0.75rem;line-height:0.75rem;float:right;">'+e.version+"</div></div></a>")}),r()("#btnSearch").click(function(){var t=r()("#txtSearch").val(),e=r()('.rune[data-name="'+t+'"]').not(".rune-not-available");if(e.popover("show"),e.length){var a=9999999;e.each(function(t,e){a=Math.min(a,parseFloat(r()(e).css("top")))}),r()("#main").animate({scrollTop:Math.max(a-50,0)},500)}else alert(c.a.getText("runenotexist"))}),r()("#btnClear").click(function(){r()('[data-toggle="popover"]').popover("hide")}),r()("#btnSelectAll").click(function(){var t=s.Data.getAstrolabe();i.a.each(t,function(t,e){K(t.Id,!0,!1)}),X(),z()}),r()("#btnSaveImage").click(function(){var t=window.open("about:blank;","_blank");r()(t.document.body).append(c.a.getText("generating")),f.a.toPng(r()(".astrolabe-container")[0],{bgcolor:"#fff"}).then(function(e){r()(t.document.body).empty(),r()(t.document.body).append(r()('<textarea style="width:100%;height:100px;">').val(window.location)),r()(t.document.body).append(r()("<img>").attr("src",e))}).catch(function(t){console.error(c.a.getText("generateerror"),t)})}),r()("#btnReset").click(function(){confirm(c.a.getText("confirmreset"))&&(i.a.each(m,function(t,e){r()("#rune"+t).data("status",0).removeClass("rune-checked")}),m=[],X(),z())}),r()("#btnSave").click(function(){U()}),r()('input[name="evo"]').change(function(){w=parseInt(this.value),B(C)}),r()("#scale").change(function(){S=parseFloat(this.value)||.2,B(C)}),r()('input[name="pathAlgorithm"]').change(function(){"custom"==(I=this.value)?r()("#algorithmWeight").show():r()("#algorithmWeight").hide()}),r()(".rune-panel-switch").click(function(){r()(".rune-panel-main").toggle()}),T=!0}},B=function(t,e){console.log("render",t,e);if(0!=t){M(C=t),r()("#main").find("img").attr("src",""),r()("#main").empty();var a=s.Data.getAstrolabe();b=i.a.min(a,function(t){return t.X}).X,k=i.a.max(a,function(t){return t.X}).X,y=i.a.min(a,function(t){return t.Y}).Y,x=i.a.max(a,function(t){return t.Y}).Y;var n,o=r()("<div>").addClass("astrolabe-container");i.a.each(a,function(t,e){var a=s.Data.getRuneCost(t.Id),n=s.Data.getRuneResetCost(t.Id),c=s.Data.getRuneDesc(t.Id,C),u=r()("<div>").addClass("rune").css("left",(t.X-b+30)*S).css("top",(x-t.Y+30)*S).css("width",60*S).css("height",60*S).attr("id","rune"+t.Id).attr("data-id",t.Id).data("rune",t).data("cost",a).data("resetCost",n).data("desc",c).data("status",0).attr("data-toggle","popover").attr("data-name",c.Name).attr("data-content",'<ul class="list-group list-group-flush"><li class="list-group-item p-1">'+(c.Desc||"")+'</li><li class="list-group-item p-1">'+i.a.reduce(a,function(t,e){return t+e.Name+"*"+e.Count+" "},"")+"</li></ul>").click(function(){F(t.Id)});1e4==t.Id&&(g.push(1e4),u.addClass("rune-center").data("status",2).attr("title","").attr("data-toggle","")),t.Evo>w&&u.addClass("rune-not-available").attr("title","").attr("data-toggle","").off("click"),i.a.any(a,function(t){return 5261==t.Id})&&u.addClass("rune-special"),(t.X-b)/(k-b)>.8&&u.attr("data-placement","left"),(x-t.Y)/(x-y)<.2&&u.attr("data-placement","bottom"),o.append(u)}),r()("#main").append(o),r()('[data-toggle="popover"]').popover({html:!0,trigger:"hover focus",container:".astrolabe-container"}),r()("#main").on("show.bs.popover",function(t){var e=r()(t.target),a=e.data("desc"),n=e.data("status"),o=r()("<div>").append(r()("<div>").attr("runeId",e.attr("data-id")).addClass("rune-icon").addClass("rune-"+(0==n?"off":"on")+"-"+a.Type).text(a.Name));e.attr("data-original-title",o.html())}),r()("#main").on("inserted.bs.popover",function(t){var e=0;r()(".popover").each(function(t,a){var n=r()(a);if(e<parseInt(n.css("z-index"))&&(e=parseInt(n.css("z-index"))),n.find("button.close").length<1){var o=r()('<button type="button" id="close" class="close">&times;</button>');o.click(function(){r()(this).parents(".popover").popover("hide")}),n.find(".popover-header").append(o)}}),r()(".popover:last").css("z-index",e+1).off("mouseenter").off("click").on("mouseenter click",function(){var t=0;r()(".popover").each(function(e,a){t<parseInt(r()(a).css("z-index"))&&(t=parseInt(r()(a).css("z-index")))}),r()(this).css("z-index",t+1)}).on("click",".rune-icon",function(){r()(t.target).popover("hide"),F(parseInt(r()(this).attr("runeId")))})}),r()("#txtSearch").empty(),i.a.each(s.Data.getAllRuneDescNameByTypeBranch(C),function(t,e){r()("#txtSearch").append(r()("<option>").text(t).val(t))}),r()(".selectpicker").selectpicker("refresh"),e&&(n=e,g=JSON.parse(d.a.decompressFromEncodedURIComponent(n))),i.a.each(g,function(t,e){K(t,!0,!0)}),i.a.each(m,function(t,e){K(t,!0,!1)}),X(),z()}},z=function(){r()(".rune-link-container").remove();var t=(k-b+120)*S,e=(x-y+120)*S,a=r()("<canvas>").attr("width",t).attr("height",e).addClass("rune-link-container");r()(".astrolabe-container").append(a);var n=a[0].getContext("2d");n.fillStyle="rgba(0, 0, 0, 0.25)",n.font="25px PingFang SC,Source Han Sans SC,Noto Sans CJK SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,sans-serif";var o=s.Data.getCurrentServer();o.isTest&&(n.textAlign="left",n.fillText(c.a.getText("alertCBT"),0,25)),n.textAlign="left",n.fillText(r()("#runeCheckCost").data("cost"),0,e-5),n.fillText(r()("#runeCost").data("cost"),0,e-35),n.font="25px Consolas",n.textAlign="right",n.fillText("ROMEL Rune BFS",t,e-35),n.fillText("Version:"+o.version+"("+o.id+")",t,e-5),i.a.each(s.Data.getAstrolabe(),function(t,e){var a=t;i.a.each(a.Link,function(t,e){var r=s.Data.getRuneDataById(t);r&&(n.beginPath(),n.moveTo((a.X-b+60)*S,(x-a.Y+60)*S),n.lineTo((r.X-b+60)*S,(x-r.Y+60)*S),n.lineWidth=3,a.Evo>w||r.Evo>w?(n.strokeStyle="rgba(233, 233, 233, 0.15)",n.stroke()):i.a.contains(g.concat(m),a.Id)&&i.a.contains(g.concat(m),r.Id)?(n.lineWidth=4,n.strokeStyle="#13a7ff",n.stroke(),n.lineWidth=3,n.strokeStyle="#85e2ff",n.stroke(),n.lineWidth=2,n.strokeStyle="#cef3ff",n.stroke(),n.lineWidth=1,n.strokeStyle="#eefcff",n.stroke()):(n.strokeStyle="#333",n.stroke()))})})},X=function(){var t=[],e=[],a=[],n=[],o=[],s=[];r()(".rune").each(function(i,c){var u=r()(c),d=(u.data("rune"),u.data("desc")),l=u.data("status"),f=u.data("cost"),h=u.data("resetCost");switch(l){case 0:break;case 1:e.push(f),n.push(h),s.push(d);break;case 2:t.push(f),a.push(h),o.push(d)}}),e=i.a.reduce(e,function(t,e){return i.a.each(e,function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count}),t},{}),t=i.a.reduce(t,function(t,e){return i.a.each(e,function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count}),t},{});var u="";i.a.each(e,function(t,e){u+=e+"*"+t+" "});var d="";i.a.each(t,function(t,e){d+=e+"*"+t+" "}),n=i.a.reduce(n,function(t,e){return i.a.each(e,function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count}),t},{}),a=i.a.reduce(a,function(t,e){return i.a.each(e,function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count}),t},{});var l="";i.a.each(n,function(t,e){l+=e+"*"+t+" "});var f="";i.a.each(a,function(t,e){f+=e+"*"+t+" "}),s=i.a.reduce(s,function(t,e){return e&&e.Key?(t[e.Key]=(t[e.Key]||0)+e.Value,t):t},{}),o=i.a.reduce(o,function(t,e){return e&&e.Key?(t[e.Key]=(t[e.Key]||0)+e.Value,t):t},{});var h="",p=0;i.a.each(s,function(t,e){p++,h+=c.a.getEquipEffect(e)+"+"+Math.round(100*t)/100+" ",p%4==0&&(h+="<br/>")});var v="";p=0,i.a.each(o,function(t,e){p++,v+=c.a.getEquipEffect(e)+"+"+Math.round(100*t)/100+" ",p%4==0&&(v+="<br/>")}),r()("#runeCheckCost").empty().append(u.trim()+"("+l.trim()+")<br/>"+h.trim()),r()("#runeCheckCost").data("cost",u.trim()+"("+l.trim()+")"),r()("#runeCost").empty().append(d.trim()+"("+f.trim()+")<br/>"+v.trim()),r()("#runeCost").data("cost",d.trim()+"("+f.trim()+")")},F=function(t){if(1e4==t)P(t);else switch(r()("#rune"+t).data("status")){case 0:K(t);break;case 1:J(t);break;case 2:P(t)}X(),z()},K=function(t,e,a){if(1e4!=t){var n=r()("#rune"+t);if(!(n.data("rune").evo>w))if(e){if(a){if(n.data("status")>=2)return;n.data("status",2).addClass("rune-saved")}else{if(n.data("status")>=1)return;n.data("status",1).addClass("rune-checked"),m.push(t)}r()('.rune-icon[runeId="'+t+'"]').toggleClass("rune-off-"+n.data("desc").Type).toggleClass("rune-on-"+n.data("desc").Type)}else{var o=[];switch(I){case"simple":o=s.Data.getPath(g.concat(m),t,w);break;case"nogold":o=s.Data.getPathWithWeight(g.concat(m),t,w);break;case"custom":var u=[{id:140,weight:parseFloat(r()("#weight140").val())||0},{id:5261,weight:parseFloat(r()("#weight5261").val())||0}];o=s.Data.getPathWithWeight(g.concat(m),t,w,u)}if(console.log("getPath",I,o),!o.length)return void alert(c.a.getText("nopath"));i.a.each(o,function(t,e){K(t,!0)})}}},P=function(t){confirm(c.a.getText("confirmuncheck"))&&J(t)},J=function(t,e){var a=r()("#rune"+t);if(!(a.data("rune").evo>w)){if(a.data("status",0).removeClass("rune-checked").removeClass("rune-saved"),r()('.rune-icon[runeId="'+t+'"]').toggleClass("rune-off-"+a.data("desc").Type).toggleClass("rune-on-"+a.data("desc").Type),g=i.a.without(g,t),m=i.a.without(m,t),!e){var n=s.Data.getConnectedComponent(g.concat(m));i.a.each(n,function(t,e){0==i.a.contains(t,1e4)&&i.a.each(t,function(t,e){J(t,!0)})})}g=i.a.union(g,[1e4])}},U=function(){g=i.a.unique(g.concat(m)),m=[],i.a.each(g,function(t,e){r()("#rune"+t).data("status",2).removeClass("rune-checked").addClass("rune-saved")}),X(),z();var t,e=(t=g,d.a.compressToEncodedURIComponent(JSON.stringify(t)));p.a.history.navigate("typeBranch/"+C+"/share/"+e+"/server/"+s.Data.getCurrentServer().id,{trigger:!1})};e.default={initUiLanguage:N,getActiveMenu:A,setActiveMenu:M,init:W,initByClass:R}}}]);