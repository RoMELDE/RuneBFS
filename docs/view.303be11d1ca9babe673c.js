webpackJsonp([6],{32:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"initUiLanguage",function(){return M}),n.d(t,"getActiveMenu",function(){return I}),n.d(t,"setActiveMenu",function(){return N}),n.d(t,"init",function(){return U}),n.d(t,"initByClass",function(){return R});var r=n(0),o=n.n(r),a=n(1),i=n.n(a),c=n(4),u=n(3),s=n(6),l=(n.n(s),n(33)),f=n.n(l),h=n(34),d=n.n(h),p=n(7),m=n.n(p),g="",v=[],y=[],w=0,b=0,C=0,x=0,P=0,T=.2,A=99999,E="nogold",k=!1,S={1:11,2:21,3:31,4:41,5:51,6:61},M=function(){o()("[data-lang]").each(function(){var e=o()(this),t=e.data("lang"),n=c.a.getText(t);e.text(n)})},I=function(){return g},N=function(e){g=e,o()("nav.navbar .active").removeClass("active");var t=o()("nav.navbar [data-type-branch-id="+e+"]");t.parents("li").addClass("active"),o()("#class").text(t.text())},R=function(e,t){S[e]&&(e=S[e]),U(e,t)},U=function(e,t){L(),V(),B(e,t)},L=function(){v=[],y=[]},V=function(){k||(o()("#version").text(u.default.getVersion()),u.default.isTest()?o()(".alert").show():o()(".alert").remove(),o()("#btnSearch").click(function(){var e=o()("#txtSearch").val(),t=o()('.rune[data-name="'+e+'"]').not(".rune-not-available");if(t.popover("show"),t.length){var n=9999999;t.each(function(e,t){n=Math.min(n,parseFloat(o()(t).css("top")))}),o()("#main").animate({scrollTop:Math.max(n-50,0)},500)}else alert(c.a.getText("runenotexist"))}),o()("#btnClear").click(function(){o()('[data-toggle="popover"]').popover("hide")}),o()("#btnSaveImage").click(function(){var e=window.open("about:blank;","_blank");o()(e.document.body).append(c.a.getText("generating")),d.a.toPng(o()(".astrolabe-container")[0],{bgcolor:"#fff"}).then(function(t){o()(e.document.body).empty(),o()(e.document.body).append(o()('<textarea style="width:100%;height:100px;">').val(window.location)),o()(e.document.body).append(o()("<img>").attr("src",t))}).catch(function(e){console.error(c.a.getText("generateerror"),e)})}),o()("#btnReset").click(function(){confirm(c.a.getText("confirmreset"))&&(i.a.each(y,function(e,t){o()("#rune"+e).data("status",0).removeClass("rune-checked")}),y=[],H(),j())}),o()("#btnSave").click(function(){W()}),o()('input[name="evo"]').change(function(){A=parseInt(this.value),B(w)}),o()("#scale").change(function(){T=parseFloat(this.value)||.2,B(w)}),o()('input[name="pathAlgorithm"]').change(function(){"custom"==(E=this.value)?o()("#algorithmWeight").show():o()("#algorithmWeight").hide()}),o()(".rune-panel-switch").click(function(){o()(".rune-panel-main").toggle()}),k=!0)},B=function(e,t){console.log("render",e,t);if(0!=e){N(w=e),o()("#main").find("img").attr("src",""),o()("#main").empty();var n=u.default.getAstrolabe();b=i.a.min(n,function(e){return e.X}).X,C=i.a.max(n,function(e){return e.X}).X,x=i.a.min(n,function(e){return e.Y}).Y,P=i.a.max(n,function(e){return e.Y}).Y;var r,a=o()("<div>").addClass("astrolabe-container");i.a.each(n,function(e,t){var n=u.default.getRuneCost(e.Id),r=u.default.getRuneResetCost(e.Id),c=u.default.getRuneDesc(e.Id,w),s=o()("<div>").addClass("rune").css("left",(e.X-b+30)*T).css("top",(P-e.Y+30)*T).css("width",60*T).css("height",60*T).attr("id","rune"+e.Id).attr("data-id",e.Id).data("rune",e).data("cost",n).data("resetCost",r).data("desc",c).data("status",0).attr("data-toggle","popover").attr("data-name",c.Name).attr("data-content",'<ul class="list-group list-group-flush"><li class="list-group-item p-1">'+(c.Desc||"")+'</li><li class="list-group-item p-1">'+i.a.reduce(n,function(e,t){return e+t.Name+"*"+t.Count+" "},"")+"</li></ul>").click(function(){F(e.Id)});1e4==e.Id&&(v.push(1e4),s.addClass("rune-center").data("status",2).attr("title","").attr("data-toggle","")),e.Evo>A&&s.addClass("rune-not-available").attr("title","").attr("data-toggle","").off("click"),i.a.any(n,function(e){return 5261==e.Id})&&s.addClass("rune-special"),(e.X-b)/(C-b)>.8&&s.attr("data-placement","left"),(P-e.Y)/(P-x)<.2&&s.attr("data-placement","bottom"),a.append(s)}),o()("#main").append(a),o()('[data-toggle="popover"]').popover({html:!0,trigger:"hover focus",container:".astrolabe-container"}),o()("#main").on("show.bs.popover",function(e){var t=o()(e.target),n=t.data("desc"),r=t.data("status"),a=o()("<div>").append(o()("<div>").attr("runeId",t.attr("data-id")).addClass("rune-icon").addClass("rune-"+(0==r?"off":"on")+"-"+n.Type).text(n.Name));t.attr("data-original-title",a.html())}),o()("#main").on("inserted.bs.popover",function(e){var t=0;o()(".popover").each(function(e,n){var r=o()(n);if(t<parseInt(r.css("z-index"))&&(t=parseInt(r.css("z-index"))),r.find("button.close").length<1){var a=o()('<button type="button" id="close" class="close">&times;</button>');a.click(function(){o()(this).parents(".popover").popover("hide")}),r.find(".popover-header").append(a)}}),o()(".popover:last").css("z-index",t+1).off("mouseenter").off("click").on("mouseenter click",function(){var e=0;o()(".popover").each(function(t,n){e<parseInt(o()(n).css("z-index"))&&(e=parseInt(o()(n).css("z-index")))}),o()(this).css("z-index",e+1)}).on("click",".rune-icon",function(){o()(e.target).popover("hide"),F(parseInt(o()(this).attr("runeId")))})}),o()("#txtSearch").empty(),i.a.each(u.default.getAllRuneDescNameByTypeBranch(w),function(e,t){o()("#txtSearch").append(o()("<option>").text(e).val(e))}),o()(".selectpicker").selectpicker("refresh"),t&&(r=t,v=JSON.parse(f.a.decompressFromEncodedURIComponent(r))),i.a.each(v,function(e,t){D(e,!0,!0)}),i.a.each(y,function(e,t){D(e,!0,!1)}),H(),j()}},j=function(){o()(".rune-link-container").remove();var e=(C-b+120)*T,t=(P-x+120)*T,n=o()("<canvas>").attr("width",e).attr("height",t).addClass("rune-link-container");o()(".astrolabe-container").append(n);var r=n[0].getContext("2d");r.fillStyle="rgba(0, 0, 0, 0.25)",r.font="25px PingFang SC,Source Han Sans SC,Noto Sans CJK SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,sans-serif",u.default.isTest()&&(r.textAlign="left",r.fillText(c.a.getText("alertCBT"),0,25)),r.textAlign="left",r.fillText(o()("#runeCheckCost").data("cost"),0,t-5),r.fillText(o()("#runeCost").data("cost"),0,t-35),r.font="25px Consolas",r.textAlign="right",r.fillText("ROMEL Rune BFS",e,t-35),r.fillText("Version:"+u.default.getVersion(),e,t-5),i.a.each(u.default.getAstrolabe(),function(e,t){var n=e;i.a.each(n.Link,function(e,t){var o=u.default.getRuneDataById(e);o&&(r.beginPath(),r.moveTo((n.X-b+60)*T,(P-n.Y+60)*T),r.lineTo((o.X-b+60)*T,(P-o.Y+60)*T),r.lineWidth=3,n.Evo>A||o.Evo>A?(r.strokeStyle="rgba(233, 233, 233, 0.15)",r.stroke()):i.a.contains(v.concat(y),n.Id)&&i.a.contains(v.concat(y),o.Id)?(r.lineWidth=4,r.strokeStyle="#13a7ff",r.stroke(),r.lineWidth=3,r.strokeStyle="#85e2ff",r.stroke(),r.lineWidth=2,r.strokeStyle="#cef3ff",r.stroke(),r.lineWidth=1,r.strokeStyle="#eefcff",r.stroke()):(r.strokeStyle="#333",r.stroke()))})})},H=function(){var e=[],t=[],n=[],r=[],a=[],u=[];o()(".rune").each(function(i,c){var s=o()(c),l=(s.data("rune"),s.data("desc")),f=s.data("status"),h=s.data("cost"),d=s.data("resetCost");switch(f){case 0:break;case 1:t.push(h),r.push(d),u.push(l);break;case 2:e.push(h),n.push(d),a.push(l)}}),t=i.a.reduce(t,function(e,t){return i.a.each(t,function(t,n){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{}),e=i.a.reduce(e,function(e,t){return i.a.each(t,function(t,n){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{});var s="";i.a.each(t,function(e,t){s+=t+"*"+e+" "});var l="";i.a.each(e,function(e,t){l+=t+"*"+e+" "}),r=i.a.reduce(r,function(e,t){return i.a.each(t,function(t,n){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{}),n=i.a.reduce(n,function(e,t){return i.a.each(t,function(t,n){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{});var f="";i.a.each(r,function(e,t){f+=t+"*"+e+" "});var h="";i.a.each(n,function(e,t){h+=t+"*"+e+" "}),u=i.a.reduce(u,function(e,t){return t&&t.Key?(e[t.Key]=(e[t.Key]||0)+t.Value,e):e},{}),a=i.a.reduce(a,function(e,t){return t&&t.Key?(e[t.Key]=(e[t.Key]||0)+t.Value,e):e},{});var d="",p=0;i.a.each(u,function(e,t){p++,d+=c.a.getEquipEffect(t)+"+"+Math.round(100*e)/100+" ",p%4==0&&(d+="<br/>")});var m="";p=0,i.a.each(a,function(e,t){p++,m+=c.a.getEquipEffect(t)+"+"+Math.round(100*e)/100+" ",p%4==0&&(m+="<br/>")}),o()("#runeCheckCost").empty().append(s.trim()+"("+f.trim()+")<br/>"+d.trim()),o()("#runeCheckCost").data("cost",s.trim()+"("+f.trim()+")"),o()("#runeCost").empty().append(l.trim()+"("+h.trim()+")<br/>"+m.trim()),o()("#runeCost").data("cost",l.trim()+"("+h.trim()+")")},F=function(e){if(1e4==e)O(e);else switch(o()("#rune"+e).data("status")){case 0:D(e);break;case 1:_(e);break;case 2:O(e)}H(),j()},D=function(e,t,n){if(1e4!=e){var r=o()("#rune"+e);if(!(r.data("rune").evo>A))if(t)n?r.data("status",2).addClass("rune-saved"):(r.data("status",1).addClass("rune-checked"),y.push(e)),o()('.rune-icon[runeId="'+e+'"]').toggleClass("rune-off-"+r.data("desc").Type).toggleClass("rune-on-"+r.data("desc").Type);else{var a=[];switch(E){case"simple":a=u.default.getPath(v.concat(y),e,A);break;case"nogold":a=u.default.getPathWithWeight(v.concat(y),e,A);break;case"custom":var s=[{id:140,weight:parseFloat(o()("#weight140").val())||0},{id:5261,weight:parseFloat(o()("#weight5261").val())||0}];a=u.default.getPathWithWeight(v.concat(y),e,A,s)}if(console.log("getPath",E,a),!a.length)return void alert(c.a.getText("nopath"));i.a.each(a,function(e,t){D(e,!0)})}}},O=function(e){confirm(c.a.getText("confirmuncheck"))&&_(e)},_=function(e,t){var n=o()("#rune"+e);if(!(n.data("rune").evo>A)){if(n.data("status",0).removeClass("rune-checked").removeClass("rune-saved"),o()('.rune-icon[runeId="'+e+'"]').toggleClass("rune-off-"+n.data("desc").Type).toggleClass("rune-on-"+n.data("desc").Type),v=i.a.without(v,e),y=i.a.without(y,e),!t){var r=u.default.getConnectedComponent(v.concat(y));i.a.each(r,function(e,t){0==i.a.contains(e,1e4)&&i.a.each(e,function(e,t){_(e,!0)})})}v=i.a.union(v,[1e4])}},W=function(){v=i.a.unique(v.concat(y)),y=[],i.a.each(v,function(e,t){o()("#rune"+e).data("status",2).removeClass("rune-checked").addClass("rune-saved")}),H(),j();var e,t=(e=v,f.a.compressToEncodedURIComponent(JSON.stringify(e)));m.a.history.navigate("typeBranch/"+w+"/share/"+t,{trigger:!1})};t.default={initUiLanguage:M,getActiveMenu:I,setActiveMenu:N,init:U,initByClass:R}},33:function(e,t,n){var r,o=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var a={compressToBase64:function(e){if(null==e)return"";var n=a._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:a._decompress(e.length,32,function(n){return o(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":a._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:a._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=a.compress(e),n=new Uint8Array(2*t.length),r=0,o=t.length;r<o;r++){var i=t.charCodeAt(r);n[2*r]=i>>>8,n[2*r+1]=i%256}return n},decompressFromUint8Array:function(t){if(null===t||void 0===t)return a.decompress(t);for(var n=new Array(t.length/2),r=0,o=n.length;r<o;r++)n[r]=256*t[2*r]+t[2*r+1];var i=[];return n.forEach(function(t){i.push(e(t))}),a.decompress(i.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),a._decompress(e.length,32,function(t){return o(n,e.charAt(t))}))},compress:function(t){return a._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,o,a,i={},c={},u="",s="",l="",f=2,h=3,d=2,p=[],m=0,g=0;for(a=0;a<e.length;a+=1)if(u=e.charAt(a),Object.prototype.hasOwnProperty.call(i,u)||(i[u]=h++,c[u]=!0),s=l+u,Object.prototype.hasOwnProperty.call(i,s))l=s;else{if(Object.prototype.hasOwnProperty.call(c,l)){if(l.charCodeAt(0)<256){for(r=0;r<d;r++)m<<=1,g==t-1?(g=0,p.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<d;r++)m=m<<1|o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o>>=1}0==--f&&(f=Math.pow(2,d),d++),delete c[l]}else for(o=i[l],r=0;r<d;r++)m=m<<1|1&o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o>>=1;0==--f&&(f=Math.pow(2,d),d++),i[s]=h++,l=String(u)}if(""!==l){if(Object.prototype.hasOwnProperty.call(c,l)){if(l.charCodeAt(0)<256){for(r=0;r<d;r++)m<<=1,g==t-1?(g=0,p.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<d;r++)m=m<<1|o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o>>=1}0==--f&&(f=Math.pow(2,d),d++),delete c[l]}else for(o=i[l],r=0;r<d;r++)m=m<<1|1&o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o>>=1;0==--f&&(f=Math.pow(2,d),d++)}for(o=2,r=0;r<d;r++)m=m<<1|1&o,g==t-1?(g=0,p.push(n(m)),m=0):g++,o>>=1;for(;;){if(m<<=1,g==t-1){p.push(n(m));break}g++}return p.join("")},decompress:function(e){return null==e?"":""==e?null:a._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var o,a,i,c,u,s,l,f=[],h=4,d=4,p=3,m="",g=[],v={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)f[o]=o;for(i=0,u=Math.pow(2,2),s=1;s!=u;)c=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),i|=(c>0?1:0)*s,s<<=1;switch(i){case 0:for(i=0,u=Math.pow(2,8),s=1;s!=u;)c=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),i|=(c>0?1:0)*s,s<<=1;l=e(i);break;case 1:for(i=0,u=Math.pow(2,16),s=1;s!=u;)c=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),i|=(c>0?1:0)*s,s<<=1;l=e(i);break;case 2:return""}for(f[3]=l,a=l,g.push(l);;){if(v.index>t)return"";for(i=0,u=Math.pow(2,p),s=1;s!=u;)c=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),i|=(c>0?1:0)*s,s<<=1;switch(l=i){case 0:for(i=0,u=Math.pow(2,8),s=1;s!=u;)c=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),i|=(c>0?1:0)*s,s<<=1;f[d++]=e(i),l=d-1,h--;break;case 1:for(i=0,u=Math.pow(2,16),s=1;s!=u;)c=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),i|=(c>0?1:0)*s,s<<=1;f[d++]=e(i),l=d-1,h--;break;case 2:return g.join("")}if(0==h&&(h=Math.pow(2,p),p++),f[l])m=f[l];else{if(l!==d)return null;m=a+a.charAt(0)}g.push(m),f[d++]=a+m.charAt(0),a=m,0==--h&&(h=Math.pow(2,p),p++)}}};return a}();void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)},34:function(e,t,n){!function(t){"use strict";var n=function(){return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:t,mimeType:function(e){var n=t(e).toLowerCase();return(r="application/font-woff",{woff:r,woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var r},dataAsUrl:function(e,t){return"data:"+t+";base64,"+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):function(e){return new Promise(function(t){for(var n=window.atob(e.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:"image/png"}))})}(e)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=t,o.href=e,o.href},getAndEncode:function(e){var t=3e4;c.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());return new Promise(function(n){var r,o=new XMLHttpRequest;if(o.onreadystatechange=function(){if(4!==o.readyState)return;if(200!==o.status)return void(r?n(r):i("cannot fetch resource: "+e+", status: "+o.status));var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];n(e)},t.readAsDataURL(o.response)},o.ontimeout=function(){r?n(r):i("timeout of "+t+"ms occured while fetching resource: "+e)},o.responseType="blob",o.timeout=t,o.open("GET",e,!0),o.send(),c.impl.options.imagePlaceholder){var a=c.impl.options.imagePlaceholder.split(/,/);a&&a[1]&&(r=a[1])}function i(e){console.error(e),n("")}})},uid:(e=0,function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++}),delay:function(e){return function(t){return new Promise(function(n){setTimeout(function(){n(t)},e)})}},asArray:function(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t},escapeXhtml:function(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=e})},width:function(e){var t=n(e,"border-left-width"),r=n(e,"border-right-width");return e.scrollWidth+t+r},height:function(e){var t=n(e,"border-top-width"),r=n(e,"border-bottom-width");return e.scrollHeight+t+r}};var e;function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function n(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}}(),r=function(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,a){return t(e)?Promise.resolve(e).then(r).then(function(t){var r=Promise.resolve(e);return t.forEach(function(e){r=r.then(function(t){return o(t,e,n,a)})}),r}):Promise.resolve(e)},shouldProcess:t,impl:{readUrls:r,inline:o}};function t(t){return-1!==t.search(e)}function r(t){for(var r,o=[];null!==(r=e.exec(t));)o.push(r[1]);return o.filter(function(e){return!n.isDataUrl(e)})}function o(e,t,r,o){return Promise.resolve(t).then(function(e){return r?n.resolveUrl(e,r):e}).then(o||n.getAndEncode).then(function(e){return n.dataAsUrl(e,n.mimeType(t))}).then(function(r){return e.replace(function(e){return new RegExp("(url\\(['\"]?)("+n.escape(e)+")(['\"]?\\))","g")}(t),"$1"+r+"$3")})}}(),o=function(){return{resolveAll:function(){return e(document).then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})},impl:{readAll:e}};function e(){return Promise.resolve(n.asArray(document.styleSheets)).then(function(e){var t=[];return e.forEach(function(e){try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),t}).then(function(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return r.shouldProcess(e.style.getPropertyValue("src"))})}).then(function(t){return t.map(e)});function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return r.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}}(),a=function(){return{inlineAll:function t(o){if(!(o instanceof Element))return Promise.resolve(o);return function(e){var t=e.style.getPropertyValue("background");return t?r.inlineAll(t).then(function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))}).then(function(){return e}):Promise.resolve(e)}(o).then(function(){return o instanceof HTMLImageElement?e(o).inline():Promise.all(n.asArray(o.childNodes).map(function(e){return t(e)}))})},impl:{newImage:e}};function e(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then(function(t){return n.dataAsUrl(t,n.mimeType(e.src))}).then(function(t){return new Promise(function(n,r){e.onload=n,e.onerror=r,e.src=t})})}}}}(),i={imagePlaceholder:void 0,cacheBust:!1},c={toSvg:u,toPng:function(e,t){return s(e,t||{}).then(function(e){return e.toDataURL()})},toJpeg:function(e,t){return s(e,t=t||{}).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})},toBlob:function(e,t){return s(e,t||{}).then(n.canvasToBlob)},toPixelData:function(e,t){return s(e,t||{}).then(function(t){return t.getContext("2d").getImageData(0,0,n.width(e),n.height(e)).data})},impl:{fontFaces:o,images:a,util:n,inliner:r,options:{}}};function u(e,t){return function(e){void 0===e.imagePlaceholder?c.impl.options.imagePlaceholder=i.imagePlaceholder:c.impl.options.imagePlaceholder=e.imagePlaceholder;void 0===e.cacheBust?c.impl.options.cacheBust=i.cacheBust:c.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then(function(e){return function(e,t,r){if(!r&&t&&!t(e))return Promise.resolve();return Promise.resolve(e).then(function(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)}).then(function(r){return function(e,t,r){var o=e.childNodes;return 0===o.length?Promise.resolve(t):function(e,t,n){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return l(t,n)}).then(function(t){t&&e.appendChild(t)})}),r}(t,n.asArray(o),r).then(function(){return t})}(e,r,t)}).then(function(t){return function(e,t){return t instanceof Element?Promise.resolve().then(function(){var r,o;r=window.getComputedStyle(e),o=t.style,r.cssText?o.cssText=r.cssText:function(e,t){n.asArray(e).forEach(function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))})}(r,o)}).then(function(){[":before",":after"].forEach(function(r){!function(r){var o=window.getComputedStyle(e,r),a=o.getPropertyValue("content");if(""!==a&&"none"!==a){var i=n.uid();t.className=t.className+" "+i;var c=document.createElement("style");c.appendChild(function(e,t,r){var o="."+e+":"+t,a=r.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(r):function(e){return n.asArray(e).map(function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}).join("; ")+";"}(r);return document.createTextNode(o+"{"+a+"}")}(i,r,o)),t.appendChild(c)}}(r)})}).then(function(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}).then(function(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach(function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)}))}).then(function(){return t}):t}(e,t)})}(e,t.filter,!0)}).then(f).then(h).then(function(e){t.bgcolor&&(e.style.backgroundColor=t.bgcolor);t.width&&(e.style.width=t.width+"px");t.height&&(e.style.height=t.height+"px");t.style&&Object.keys(t.style).forEach(function(n){e.style[n]=t.style[n]});return e}).then(function(r){return function(e,t,r){return Promise.resolve(e).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)}).then(n.escapeXhtml).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+r+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})}(r,t.width||n.width(e),t.height||n.height(e))})}function s(e,t){return u(e,t).then(n.makeImage).then(n.delay(100)).then(function(r){var o=function(e){var r=document.createElement("canvas");if(r.width=t.width||n.width(e),r.height=t.height||n.height(e),t.bgcolor){var o=r.getContext("2d");o.fillStyle=t.bgcolor,o.fillRect(0,0,r.width,r.height)}return r}(e);return o.getContext("2d").drawImage(r,0,0),o})}function l(e,t,r){if(!r&&t&&!t(e))return Promise.resolve();return Promise.resolve(e).then(o).then(function(n){return a(e,n,t)}).then(function(t){return i(e,t)});function o(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)}function a(e,t,r){var o=e.childNodes;return 0===o.length?Promise.resolve(t):function(e,t,n){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return l(t,n)}).then(function(t){t&&e.appendChild(t)})}),r}(t,n.asArray(o),r).then(function(){return t});function a(e,t,n){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return l(t,n)}).then(function(t){t&&e.appendChild(t)})}),r}}function i(e,t){return t instanceof Element?Promise.resolve().then(function(){!function(e,t){e.cssText?t.cssText=e.cssText:function(e,t){n.asArray(e).forEach(function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))})}(e,t)}(window.getComputedStyle(e),t.style)}).then(function(){[":before",":after"].forEach(function(r){!function(r){var o=window.getComputedStyle(e,r),a=o.getPropertyValue("content");if(""===a||"none"===a)return;var i=n.uid();t.className=t.className+" "+i;var c=document.createElement("style");c.appendChild(function(e,t,r){var o="."+e+":"+t,a=r.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(r):function(e){return n.asArray(e).map(function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}).join("; ")+";"}(r);return document.createTextNode(o+"{"+a+"}")}(i,r,o)),t.appendChild(c)}(r)})}).then(function(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value);e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}).then(function(){if(!(t instanceof SVGElement))return;if(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),!(t instanceof SVGRectElement))return;["width","height"].forEach(function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)})}).then(function(){return t}):t;function r(){function r(e,t){if(e.cssText)t.cssText=e.cssText;else r(e,t);function r(e,t){n.asArray(e).forEach(function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))})}}r(window.getComputedStyle(e),t.style)}function o(){function r(r){var o=window.getComputedStyle(e,r),a=o.getPropertyValue("content");if(a===""||a==="none")return;var i=n.uid();t.className=t.className+" "+i;var c=document.createElement("style");function u(e,t,r){var o="."+e+":"+t,a=r.cssText?i(r):c(r);return document.createTextNode(o+"{"+a+"}");function i(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function c(e){return n.asArray(e).map(t).join("; ")+";";function t(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}}}c.appendChild(u(i,r,o)),t.appendChild(c)}[":before",":after"].forEach(function(e){r(e)})}function a(){if(e instanceof HTMLTextAreaElement)t.innerHTML=e.value;if(e instanceof HTMLInputElement)t.setAttribute("value",e.value)}function i(){if(!(t instanceof SVGElement))return;if(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),!(t instanceof SVGRectElement))return;["width","height"].forEach(function(e){var n=t.getAttribute(e);if(!n)return;t.style.setProperty(e,n)})}}}function f(e){return o.resolveAll().then(function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e})}function h(e){return a.inlineAll(e).then(function(){return e})}e.exports=c}()}});