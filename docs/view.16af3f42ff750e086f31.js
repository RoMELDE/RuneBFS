(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{41:function(e,t,a){"use strict";a.r(t),a.d(t,"initUiLanguage",function(){return N}),a.d(t,"getActiveMenu",function(){return A}),a.d(t,"setActiveMenu",function(){return M}),a.d(t,"init",function(){return W}),a.d(t,"initByClass",function(){return R});var n=a(1),r=a.n(n),o=a(0),i=a.n(o),c=a(3),s=a(6),u=(a(5),a(39)),d=a.n(u),l=a(40),f=a.n(l),h=a(15),p=a.n(h),v="",g=[],m=[],C=0,b=0,k=0,x=0,y=0,S=.2,w=99999,T="nogold",I=!1,D={1:11,2:21,3:31,4:41,5:51,6:61},N=function(){r()("[data-lang]").each(function(){var e=r()(this),t=e.data("lang"),a=c.a.getText(t);e.text(a)})},A=function(){return v},M=function(e){v=e,r()("nav.navbar [data-type-branch-id].active").removeClass("active");var t=r()("nav.navbar [data-type-branch-id="+e+"]");t.addClass("active"),t.parents("li").addClass("active"),r()("#class").text(t.text())},R=function(e,t,a){D[e]&&(e=D[e]),W(e,t,a)},W=function(e,t,a){a&&a!=s.Data.getCurrentServer().id&&(s.Data.setCurrentServer(a),location.reload()),E(),Y(),B(e,t)},E=function(){g=[],m=[]},Y=function(){if(!I){var e=s.Data.getCurrentServer();r()("#server").text(e.name),r()("#version").text(e.version),e.isTest?r()(".alert").show():r()(".alert").remove(),i.a.each(s.Data.getAllServers(),function(t,a){t.version&&r()("#serverDivider").before('<a class="dropdown-item '+(t.id==e.id?" active ":"")+(t.version?"":" disabled ")+'" href="#server/'+t.id+'">'+t.name+'<div class="m-0" style="font-size:0.75rem;line-height:0.75rem;">'+t.version+"</div></a>")}),r()("#btnSearch").click(function(){var e=r()("#txtSearch").val(),t=r()('.rune[data-name="'+e+'"]').not(".rune-not-available");if(t.popover("show"),t.length){var a=9999999;t.each(function(e,t){a=Math.min(a,parseFloat(r()(t).css("top")))}),r()("#main").animate({scrollTop:Math.max(a-50,0)},500)}else alert(c.a.getText("runenotexist"))}),r()("#btnClear").click(function(){r()('[data-toggle="popover"]').popover("hide")}),r()("#btnSelectAll").click(function(){var e=s.Data.getAstrolabe();i.a.each(e,function(e,t){K(e.Id,!0,!1)}),z(),X()}),r()("#btnSaveImage").click(function(){var e=window.open("about:blank;","_blank");r()(e.document.body).append(c.a.getText("generating")),f.a.toPng(r()(".astrolabe-container")[0],{bgcolor:"#fff"}).then(function(t){r()(e.document.body).empty(),r()(e.document.body).append(r()('<textarea style="width:100%;height:100px;">').val(window.location)),r()(e.document.body).append(r()("<img>").attr("src",t))}).catch(function(e){console.error(c.a.getText("generateerror"),e)})}),r()("#btnReset").click(function(){confirm(c.a.getText("confirmreset"))&&(i.a.each(m,function(e,t){r()("#rune"+e).data("status",0).removeClass("rune-checked")}),m=[],z(),X())}),r()("#btnSave").click(function(){U()}),r()('input[name="evo"]').change(function(){w=parseInt(this.value),B(C)}),r()("#scale").change(function(){S=parseFloat(this.value)||.2,B(C)}),r()('input[name="pathAlgorithm"]').change(function(){"custom"==(T=this.value)?r()("#algorithmWeight").show():r()("#algorithmWeight").hide()}),r()(".rune-panel-switch").click(function(){r()(".rune-panel-main").toggle()}),I=!0}},B=function(e,t){console.log("render",e,t);if(0!=e){M(C=e),r()("#main").find("img").attr("src",""),r()("#main").empty();var a=s.Data.getAstrolabe();b=i.a.min(a,function(e){return e.X}).X,k=i.a.max(a,function(e){return e.X}).X,x=i.a.min(a,function(e){return e.Y}).Y,y=i.a.max(a,function(e){return e.Y}).Y;var n,o=r()("<div>").addClass("astrolabe-container");i.a.each(a,function(e,t){var a=s.Data.getRuneCost(e.Id),n=s.Data.getRuneResetCost(e.Id),c=s.Data.getRuneDesc(e.Id,C),u=r()("<div>").addClass("rune").css("left",(e.X-b+30)*S).css("top",(y-e.Y+30)*S).css("width",60*S).css("height",60*S).attr("id","rune"+e.Id).attr("data-id",e.Id).data("rune",e).data("cost",a).data("resetCost",n).data("desc",c).data("status",0).attr("data-toggle","popover").attr("data-name",c.Name).attr("data-content",'<ul class="list-group list-group-flush"><li class="list-group-item p-1">'+(c.Desc||"")+'</li><li class="list-group-item p-1">'+i.a.reduce(a,function(e,t){return e+t.Name+"*"+t.Count+" "},"")+"</li></ul>").click(function(){F(e.Id)});1e4==e.Id&&(g.push(1e4),u.addClass("rune-center").data("status",2).attr("title","").attr("data-toggle","")),e.Evo>w&&u.addClass("rune-not-available").attr("title","").attr("data-toggle","").off("click"),i.a.any(a,function(e){return 5261==e.Id})&&u.addClass("rune-special"),(e.X-b)/(k-b)>.8&&u.attr("data-placement","left"),(y-e.Y)/(y-x)<.2&&u.attr("data-placement","bottom"),o.append(u)}),r()("#main").append(o),r()('[data-toggle="popover"]').popover({html:!0,trigger:"hover focus",container:".astrolabe-container"}),r()("#main").on("show.bs.popover",function(e){var t=r()(e.target),a=t.data("desc"),n=t.data("status"),o=r()("<div>").append(r()("<div>").addClass("rune-icon").addClass("rune-"+(0==n?"off":"on")+"-"+a.Type).text(a.Name).append('<div class="rune-id d-none">'+t.attr("data-id")));t.attr("data-original-title",o.html())}),r()("#main").on("inserted.bs.popover",function(e){var t=0;r()(".popover").each(function(e,a){var n=r()(a);if(t<parseInt(n.css("z-index"))&&(t=parseInt(n.css("z-index"))),n.find("button.close").length<1){var o=r()('<button type="button" id="close" class="close">&times;</button>');o.click(function(){r()(this).parents(".popover").popover("hide")}),n.find(".popover-header").append(o)}}),r()(".popover:last").css("z-index",t+1).off("mouseenter").off("click").on("mouseenter click",function(){var e=0;r()(".popover").each(function(t,a){e<parseInt(r()(a).css("z-index"))&&(e=parseInt(r()(a).css("z-index")))}),r()(this).css("z-index",e+1)}).on("click",".rune-icon",function(){r()(e.target).popover("hide"),F(parseInt(r()(this).find(".rune-id").text()))})}),r()("#txtSearch").empty(),i.a.each(s.Data.getAllRuneDescNameByTypeBranch(C),function(e,t){r()("#txtSearch").append(r()("<option>").text(e).val(e))}),r()(".selectpicker").selectpicker("refresh"),t&&(n=t,g=JSON.parse(d.a.decompressFromEncodedURIComponent(n))),i.a.each(g,function(e,t){K(e,!0,!0)}),i.a.each(m,function(e,t){K(e,!0,!1)}),z(),X()}},X=function(){r()(".rune-link-container").remove();var e=(k-b+120)*S,t=(y-x+120)*S,a=r()("<canvas>").attr("width",e).attr("height",t).addClass("rune-link-container");r()(".astrolabe-container").append(a);var n=a[0].getContext("2d");n.fillStyle="rgba(0, 0, 0, 0.25)",n.font="25px PingFang SC,Source Han Sans SC,Noto Sans CJK SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,sans-serif";var o=s.Data.getCurrentServer();o.isTest&&(n.textAlign="left",n.fillText(c.a.getText("alertCBT"),0,25)),n.textAlign="left",n.fillText(r()("#runeCheckCost").data("cost"),0,t-5),n.fillText(r()("#runeCost").data("cost"),0,t-35),n.font="25px Consolas",n.textAlign="right",n.fillText("ROMEL Rune BFS",e,t-35),n.fillText("Version:"+o.version+"("+o.id+")",e,t-5),i.a.each(s.Data.getAstrolabe(),function(e,t){var a=e;i.a.each(a.Link,function(e,t){var r=s.Data.getRuneDataById(e);r&&(n.beginPath(),n.moveTo((a.X-b+60)*S,(y-a.Y+60)*S),n.lineTo((r.X-b+60)*S,(y-r.Y+60)*S),n.lineWidth=3,a.Evo>w||r.Evo>w?(n.strokeStyle="rgba(233, 233, 233, 0.15)",n.stroke()):i.a.contains(g.concat(m),a.Id)&&i.a.contains(g.concat(m),r.Id)?(n.lineWidth=4,n.strokeStyle="#13a7ff",n.stroke(),n.lineWidth=3,n.strokeStyle="#85e2ff",n.stroke(),n.lineWidth=2,n.strokeStyle="#cef3ff",n.stroke(),n.lineWidth=1,n.strokeStyle="#eefcff",n.stroke()):(n.strokeStyle="#333",n.stroke()))})})},z=function(){var e=[],t=[],a=[],n=[],o=[],s=[];r()(".rune").each(function(i,c){var u=r()(c),d=(u.data("rune"),u.data("desc")),l=u.data("status"),f=u.data("cost"),h=u.data("resetCost");switch(l){case 0:break;case 1:t.push(f),n.push(h),s.push(d);break;case 2:e.push(f),a.push(h),o.push(d)}}),t=i.a.reduce(t,function(e,t){return i.a.each(t,function(t,a){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{}),e=i.a.reduce(e,function(e,t){return i.a.each(t,function(t,a){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{});var u="";i.a.each(t,function(e,t){u+=t+"*"+e+" "});var d="";i.a.each(e,function(e,t){d+=t+"*"+e+" "}),n=i.a.reduce(n,function(e,t){return i.a.each(t,function(t,a){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{}),a=i.a.reduce(a,function(e,t){return i.a.each(t,function(t,a){e[t.Name]=(e[t.Name]||0)+t.Count}),e},{});var l="";i.a.each(n,function(e,t){l+=t+"*"+e+" "});var f="";i.a.each(a,function(e,t){f+=t+"*"+e+" "}),s=i.a.reduce(s,function(e,t){return t&&t.Key?(e[t.Key]=(e[t.Key]||0)+t.Value,e):e},{}),o=i.a.reduce(o,function(e,t){return t&&t.Key?(e[t.Key]=(e[t.Key]||0)+t.Value,e):e},{});var h="",p=0;i.a.each(s,function(e,t){p++,h+=c.a.getEquipEffect(t)+"+"+Math.round(100*e)/100+" ",p%4==0&&(h+="<br/>")});var v="";p=0,i.a.each(o,function(e,t){p++,v+=c.a.getEquipEffect(t)+"+"+Math.round(100*e)/100+" ",p%4==0&&(v+="<br/>")}),r()("#runeCheckCost").empty().append(u.trim()+"("+l.trim()+")<br/>"+h.trim()),r()("#runeCheckCost").data("cost",u.trim()+"("+l.trim()+")"),r()("#runeCost").empty().append(d.trim()+"("+f.trim()+")<br/>"+v.trim()),r()("#runeCost").data("cost",d.trim()+"("+f.trim()+")")},F=function(e){if(1e4==e)P(e);else switch(r()("#rune"+e).data("status")){case 0:K(e);break;case 1:J(e);break;case 2:P(e)}z(),X()},K=function(e,t,a){if(1e4!=e){var n=r()("#rune"+e);if(!(n.data("rune").evo>w))if(t){if(a){if(n.data("status")>=2)return;n.data("status",2).addClass("rune-saved")}else{if(n.data("status")>=1)return;n.data("status",1).addClass("rune-checked"),m.push(e)}r()('.rune-icon[runeId="'+e+'"]').toggleClass("rune-off-"+n.data("desc").Type).toggleClass("rune-on-"+n.data("desc").Type)}else{var o=[];switch(T){case"simple":o=s.Data.getPath(g.concat(m),e,w);break;case"nogold":o=s.Data.getPathWithWeight(g.concat(m),e,w);break;case"custom":var u=[{id:140,weight:parseFloat(r()("#weight140").val())||0},{id:5261,weight:parseFloat(r()("#weight5261").val())||0}];o=s.Data.getPathWithWeight(g.concat(m),e,w,u)}if(console.log("getPath",T,o),!o.length)return void alert(c.a.getText("nopath"));i.a.each(o,function(e,t){K(e,!0)})}}},P=function(e){confirm(c.a.getText("confirmuncheck"))&&J(e)},J=function(e,t){var a=r()("#rune"+e);if(!(a.data("rune").evo>w)){if(a.data("status",0).removeClass("rune-checked").removeClass("rune-saved"),r()('.rune-icon[runeId="'+e+'"]').toggleClass("rune-off-"+a.data("desc").Type).toggleClass("rune-on-"+a.data("desc").Type),g=i.a.without(g,e),m=i.a.without(m,e),!t){var n=s.Data.getConnectedComponent(g.concat(m));i.a.each(n,function(e,t){0==i.a.contains(e,1e4)&&i.a.each(e,function(e,t){J(e,!0)})})}g=i.a.union(g,[1e4])}},U=function(){g=i.a.unique(g.concat(m)),m=[],i.a.each(g,function(e,t){r()("#rune"+e).data("status",2).removeClass("rune-checked").addClass("rune-saved")}),z(),X();var e,t=(e=g,d.a.compressToEncodedURIComponent(JSON.stringify(e)));p.a.history.navigate("typeBranch/"+C+"/share/"+t+"/server/"+s.Data.getCurrentServer().id,{trigger:!1})};t.default={initUiLanguage:N,getActiveMenu:A,setActiveMenu:M,init:W,initByClass:R}}}]);